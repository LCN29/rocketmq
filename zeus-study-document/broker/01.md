
broker 简单配置

```conf
# 集群名称
brokerClusterName = LcnCluster
# 集群中的名称
brokerName = broker-lcn
# 主节点
brokerId = 0
# 每天什么时间删除过去消息
deleteWhen = 04
# 文件保留时间，也就是从最后一次更新时间到现在，如果超过了该时间，则认为是过期文件，可以被删除，单位小时
fileReservedTime = 48
# master 异步同步从节点
brokerRole = ASYNC_MASTER
# 异步刷盘
flushDiskType = ASYNC_FLUSH
# 是否允许自动创建 Topic
autoCreateTopicEnable = true
# name server 的地址列表
namesrvAddr = 127.0.0.1:9876
```

## Broker 文件存储目录
```log

${user.home}/store
├── commitlog                   # 存储所有消息内容
│   ├── 00000000000000000000    # 文件名默认是第一个消息的偏移量, 这样通过文件名 + 一个文件大小, 就可以定位到下一个文件的名称
│   ├── 00000000001073741824
│   └── ...
│
├── config                      # 存储配置文件
│   ├── consumerOffset.json     # 存储消费者的消费进度
│   ├── delayOffset.json        # 存储延迟消息进度
│   ├── subscriptionGroup.json  # 存储订阅组信息
│   └── topics.json             # 存储主题配置信息
│
├── consumequeue                # 存储每个主题的消息队列索引
│   ├── TopicA                  # TopicA 的消息队列索引
│   │   ├── 0                   # TopicA 的第一个队列
│   │   │   ├── 00000000000000000000    
│   │   │   ├── 00000000000000000001
│   │   │   └── ...
│   │   └── 1
│   │       ├── 00000000000000000000
│   │       ├── 00000000000000000001
│   │       └── ...
│   └── ...
│
├── index                       # 存储消息索引文件
│   ├── 20210602101245678       # 索引文件名是其创建的时间
│   ├── 20210602112356789
│   └── ...
│
├── abort                       # broker 启动时会创建一个 abort 文件, 关闭时会删除, 然后创建是判断是否有这个文件, 有说明上次异常退出了, 会进行数据恢复
│
├── checkpoint                  # 检查点文件, 作用是记录 CommitLog, ConsumeQueue, IndexFile 的刷盘时间点, 默认为 4kb, 但是现在只用到了钱 24 个字节
│
└── lock                       # 文件锁用来保证磁盘上的这个目录同时只能有一个 Broker 的可以操作
```

commitlog
默认 1G, 所有 Topic 的消息按照抵达顺序依次追加到 CommitLog 中, 写完就另起一个文件, 文件名是上一个文件的最后一个消息的偏移量

consumequeue
每个 Topic 的每个 Queue 对应一个 ConsumeQueue 文件, ConsumeQueue 文件中存储了消息在 CommitLog 文件中的物理偏移量, 以及消息的长度和 Tag 的 HashCode, 每个 ConsumeQueue 文件的记录大小是固定的（20 字节）

index
IndexFile 是基于消息的 key 创建的索引文件。如果消息带有 key，会在 IndexFile 中记录消息的索引。IndexFile 文件的命名规则是时间戳，每个 IndexFile 文件中存储了多个消息的索引信息。



checkpoint
    physicMsgTimestamp  CommitLog 文件刷盘时间点
    logicsMsgTimestamp  ConsumeQueue 文件刷盘时间点
    indexMsgTimestamp   Index 文件刷盘时间点


https://cloud.tencent.com/developer/article/1850208
